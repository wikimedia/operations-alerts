# deploy-tag: ops
# deploy-site: eqiad, codfw

groups:
  - name: query_service
    rules:
    - alert: QueryServiceHighThreadCount
      annotations:
        description: 'High thread count on {{ $labels.instance }} / {{ $labels.cluster }}'
        summary: 'Blazegraph running on {{ $labels.instance }} as part of the {{ $labels.cluster }} cluster has a high thread count.'
        dashboard: 'https://w.wiki/Gaze'
        runbook: 'https://wikitech.wikimedia.org/wiki/Wikidata_Query_Service/Runbook#Resolving_blazegraph_deadlock'
      expr: jvm_threads_current{job=~'jmx_w[cd]qs_blazegraph'} > 1000
      for: 30m
      labels:
        severity: critical
        team: data-platform
