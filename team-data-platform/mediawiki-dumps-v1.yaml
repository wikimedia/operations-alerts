# deploy-tag: k8s-dse
# deploy-site: eqiad
groups:
  - name: dumps-v1-pvc-abvailable-space
    rules:
    - alert: MediawikiDumpsV1PVCAvailableSpaceWarning
      annotations:
        description: 'PVC {{ $labels.persistentvolumeclaim }}.{{ $labels.namespace }} is 85% full'
        summary: 'PVC {{ $labels.persistentvolumeclaim }}.{{ $labels.namespace }} is 85% full'
        dashboard: "https://grafana.wikimedia.org/goto/Ge3TKCwNR?orgId=1"
        runbook: "https://wikitech.wikimedia.org/wiki/Dumps/Airflow/Operations#The_dumps_CephFS_volume_is_filling_up"
      expr: (kubelet_volume_stats_available_bytes{namespace="mediawiki-dumps-legacy", persistentvolumeclaim="mediawiki-dumps-legacy-fs"} / kubelet_volume_stats_capacity_bytes{namespace="mediawiki-dumps-legacy", persistentvolumeclaim="mediawiki-dumps-legacy-fs"} * 100) < 15
      for: 5m
      labels:
        severity: warning
        team: data-platform
    - alert: MediawikiDumpsV1PVCAvailableSpaceCritical
      annotations:
        description: 'PVC {{ $labels.persistentvolumeclaim }}.{{ $labels.namespace }} is 90% full'
        summary: 'PVC {{ $labels.persistentvolumeclaim }}.{{ $labels.namespace }} is 90% full'
        dashboard: "https://grafana.wikimedia.org/goto/Ge3TKCwNR?orgId=1"
        runbook: "https://wikitech.wikimedia.org/wiki/Dumps/Airflow/Operations#The_dumps_CephFS_volume_is_filling_up"
      expr: (kubelet_volume_stats_available_bytes{namespace="mediawiki-dumps-legacy", persistentvolumeclaim="mediawiki-dumps-legacy-fs"} / kubelet_volume_stats_capacity_bytes{namespace="mediawiki-dumps-legacy", persistentvolumeclaim="mediawiki-dumps-legacy-fs"} * 100) < 10
      for: 5m
      labels:
        severity: critical
        team: data-platform