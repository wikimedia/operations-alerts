# deploy-tag: k8s-mlserve
# deploy-site: eqiad, codfw

groups:
  - name: inf_services
    rules:
      - alert: InfServiceHighMemoryUsage
        expr: (container_memory_usage_bytes{container="kserve-container"} / container_spec_memory_limit_bytes{container="kserve-container"}) > 0.9
        for: 30m
        labels:
          team: ml
          severity: critical
        annotations:
          summary: "High Memory usage detected in Inference Service"
          description: "Memory usage for kserve-container in pod {{ $labels.pod }} has exceeded 90% for more than 30 minutes."
          runbook: https://wikitech.wikimedia.org/w/index.php?title=Machine_Learning/LiftWing/Alerts#Inference_Services_High_Memory_Usage_-_InfServiceHighMemoryUsage_alert
          dashboard: https://grafana.wikimedia.org/d/hyl18XgMk/kubernetes-container-details?orgId=1&var-datasource={{ $externalLabels.site }}%20prometheus%2F{{ $externalLabels.prometheus }}&var-namespace={{ $labels.namespace }}&var-pod={{ $labels.pod }}
