# deploy-tag: ops
# deploy-site: eqiad

groups:
  - name: data_pipelines
    rules:
      - alert: ImageSuggestionsPushFailure
        for: 15m
        expr: push_failure_time_seconds{job="image_suggestions_pipeline"} != 0
        labels:
          team: structured-data
          severity: warning
        annotations:
          summary: "Failure in pushing image suggestions metrics"
          description: "Prometheus is reporting a failure to push image suggestions metrics for 15m"
          runbook: TODO
          dashboard: TODO

      - alert: ImageSuggestionsTooLongSinceLastPush
        expr: time() - push_time_seconds{job="image_suggestions_pipeline"} > 864000 # 10 days
        labels:
          team: structured-data
          severity: warning
        annotations:
          summary: "More than expected time since image suggestions metrics were pushed"
          description: "Image suggestions metrics were last pushed to prometheus more than 10 days ago. Expect them to be pushed once per week."
          runbook: TODO
          dashboard: TODO
