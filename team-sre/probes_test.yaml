rule_files:
  - probes.yaml
evaluation_interval: 1m
tests:
  - interval: 1m
    input_series:
      - series: 'probe_success{job="probes/test", module="http_test", instance="fail:443"}'
        values: '1+0x5 0+0x20'
      - series: 'probe_success{job="probes/test", module="http_test", instance="ok:443"}'
        values: '1+0x30'
    external_labels:
      site: eqiad
    alert_rule_test:
    - alertname: ProbeDown
      eval_time: 10m
      exp_alerts:
       - exp_labels:
           job: probes/test
           team: sre
           severity: warning
           instance: fail:443
           module: http_test
         exp_annotations:
           description: fail:443 failed when probed by http_test from eqiad.
             Availability is 0%.
           summary: Service fail:443 has failed probes (http_test)
           dashboard: 'https://grafana.wikimedia.org/d/O0nHhdhnz/network-probes-overview?var-job=probes/test&var-module=http'
           logs: 'https://logstash.wikimedia.org/app/dashboards#/view/f3e709c0-a5f8-11ec-bf8e-43f1807d5bc2?_g=(filters:!((query:(match_phrase:(service.name:http_test)))))'
